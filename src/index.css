@tailwind base;
@tailwind components;
@tailwind utilities;

/* Quill Editor Styles */
.ql-editor {
  min-height: 200px;
  font-size: 16px;
  direction: rtl;
}

.ql-editor.ql-blank::before {
  font-style: normal;
  color: #999;
}

/* ========================================
   KaTeX RTL Support for Arabic
   ======================================== */

/* Force RTL natural for Arabic ONLY when inside math-rtl container */
.math-rtl .katex {
  direction: rtl !important;
  text-align: right !important;
  unicode-bidi: embed !important;
}


/* ========================================
   Superscripts (Powers) RTL Support
   ======================================== */
/* For Arabic RTL, superscripts (like 2³) should show as ³2 (power on the LEFT) */
/* Apply ONLY in RTL mode */
/* Wrap base + superscript in flex container - ONLY in RTL mode */
.math-rtl .katex .mord + .msupsub,
.math-rtl .katex .minner + .msupsub,
.math-rtl .katex .mop + .msupsub:not(.op-limits .msupsub) {
  display: inline-flex !important;
  flex-direction: row-reverse !important;
  vertical-align: baseline !important;
}

/* Force the parent .base to be flex too - ONLY in RTL mode */
/* Note: Using direct descendant selectors for better browser compatibility */
.math-rtl .katex .base {
  display: inline-flex !important;
  flex-direction: row-reverse !important;
}

/* RTL mode: Flip ALL superscripts (msup) - power on LEFT */
.math-rtl .katex .msup,
.math-rtl .katex .msupsub {
  display: inline-flex !important;
  flex-direction: row-reverse !important;
  flex-wrap: nowrap !important;
  align-items: baseline !important;
  direction: ltr !important;
  vertical-align: baseline !important;
  justify-content: flex-start !important;
}

/* RTL mode: Reverse order of base and superscript using CSS order */
.math-rtl .katex .msup > *:first-child,
.math-rtl .katex .msupsub > *:first-child {
  order: 2 !important;
}

.math-rtl .katex .msup > *:last-child,
.math-rtl .katex .msupsub > *:last-child {
  order: 1 !important;
}

/* Skip operator limits in RTL */
.math-rtl .katex .mop.op-limits .msup,
.math-rtl .katex .mop.op-limits .msupsub {
  flex-direction: row !important;
}

/* LTR mode: Normal order (2³) - powers stay on right */
.math-ltr .katex .mord + .msupsub,
.math-ltr .katex .minner + .msupsub,
.math-ltr .katex .mop + .msupsub {
  display: inline !important;
  flex-direction: initial !important;
  vertical-align: baseline !important;
}

.math-ltr .katex .base {
  display: inline !important;
  flex-direction: initial !important;
}

/* LTR mode: Normal order for msup */
.math-ltr .katex .msup,
.math-ltr .katex .msupsub {
  display: inline !important;
  flex-direction: row !important;
  align-items: initial !important;
  direction: initial !important;
  vertical-align: baseline !important;
}

/* Exception for ∑ and ∫ operators - keep them in normal LTR to avoid flipping */
.katex .mop.op-limits {
  direction: ltr !important;
  unicode-bidi: normal !important;
  display: inline-block !important;
  vertical-align: middle !important;
}

/* All content inside op-limits should stay LTR */
.katex .mop.op-limits * {
  direction: ltr !important;
  unicode-bidi: normal !important;
}

/* Force RTL natural for react-katex components */
.katex-display,
.katex-display > .katex {
  direction: rtl !important;
  text-align: right !important;
  unicode-bidi: embed !important;
}

span > .katex {
  direction: rtl !important;
  text-align: right !important;
  unicode-bidi: embed !important;
}

/* ========================================
   KaTeX Fraction Styling - Enhanced RTL
   ======================================== */

/* Ensure the fraction structure is correctly styled in RTL */
.katex .frac {
  display: inline-block !important;
  vertical-align: middle !important;
  text-align: center !important;
  position: relative !important;
  margin: 0 2px !important;
}

.katex .frac > span {
  display: block !important;
}

/* Fraction numerator (top number) - centered alignment */
.katex .frac-num {
  display: block !important;
  text-align: center !important;
  line-height: 1.2 !important;
  margin: 0 !important;
  padding: 0 !important;
  width: 100% !important;
}

/* Fraction line (horizontal bar) - ensure visibility */
.katex .frac-line {
  border-bottom: 0.04em solid currentColor !important;
  border-top: none !important;
  display: block !important;
  width: 100% !important;
  height: 0 !important;
  margin: 0.3em 0 !important;
  padding: 0 !important;
  position: relative !important;
  transform: translateY(-0.5em) !important;
}


/* Fraction denominator (bottom number) - centered alignment */
.katex .frac-den {
  display: block !important;
  text-align: center !important;
  line-height: 1.2 !important;
  margin: 0 !important;
  padding: 0 !important;
  width: 100% !important;
}

/* Additional adjustments for text alignment and legibility in RTL */
.katex .frac-num,
.katex .frac-den {
  text-align: center;
}

@keyframes float-rotate {
  0% {
    transform: translateY(0px) rotate(0deg) scale(1);
  }
  25% {
    transform: translateY(-10px) rotate(5deg) scale(1.1);
  }
  50% {
    transform: translateY(-15px) rotate(0deg) scale(1.15);
  }
  75% {
    transform: translateY(-10px) rotate(-5deg) scale(1.1);
  }
  100% {
    transform: translateY(0px) rotate(0deg) scale(1);
  }
}

/* Button entrance animation */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

/* Apply animation to buttons */
button[class*="px-10 py-6"] {
  animation: slideInUp 0.5s ease-out forwards;
  opacity: 0;
}

/* Animation for laptop - gentle floating */
@keyframes laptop-float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-8px);
  }
}

.laptop-animation {
  animation: laptop-float 4s ease-in-out infinite;
}

/* Animation for book - emerging from laptop with smooth movement */
@keyframes book-emerge {
  0% {
    transform: translateY(100px) scale(0.3);
    opacity: 0;
  }
  60% {
    transform: translateY(-10px) scale(1.05);
    opacity: 1;
  }
  100% {
    transform: translateY(0px) scale(1);
    opacity: 1;
  }
}

/* Book floating animation after emerging */
@keyframes book-float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-12px);
  }
}

.book-animation {
  animation: book-emerge 2.5s ease-out forwards,
             book-float 3s ease-in-out 2.5s infinite;
}

/* Book pages opening animation - subtle movement */
@keyframes book-page-left {
  0%, 100% {
    transform: rotateZ(0deg);
  }
  50% {
    transform: rotateZ(-8deg);
  }
}

.book-page-left {
  animation: book-page-left 4s ease-in-out infinite 2.5s;
  transform-origin: 0% 50%;
}

@keyframes book-page-right {
  0%, 100% {
    transform: rotateZ(0deg);
  }
  50% {
    transform: rotateZ(8deg);
  }
}

.book-page-right {
  animation: book-page-right 4s ease-in-out infinite 2.5s;
  transform-origin: 100% 50%;
}

/* Pulsing dots - gentle glow */
@keyframes pulse {
  0%, 100% {
    opacity: 0.7;
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(1.3);
  }
}

.pulse-dot {
  animation: pulse 2.5s ease-in-out infinite;
  transform-origin: center;
}

/* Floating particles around book */
@keyframes float-particle {
  0% {
    transform: translateY(0px) translateX(0px);
    opacity: 0.4;
  }
  50% {
    transform: translateY(-25px) translateX(15px);
    opacity: 0.8;
  }
  100% {
    transform: translateY(0px) translateX(0px);
    opacity: 0.4;
  }
}

.float-particle {
  animation: float-particle 4s ease-in-out infinite;
  transform-origin: center;
}

/* Connection lines animation - data flow effect */
@keyframes connection-dash {
  0% {
    stroke-dashoffset: 0;
    opacity: 0.3;
  }
  50% {
    opacity: 0.6;
  }
  100% {
    stroke-dashoffset: 30;
    opacity: 0.3;
  }
}

.connection-line {
  animation: connection-dash 3s linear infinite;
}

/* Floating animation for background shapes */
@keyframes float {
  0%, 100% {
    transform: translateY(0px) translateX(0px);
  }
  25% {
    transform: translateY(-20px) translateX(10px);
  }
  50% {
    transform: translateY(-10px) translateX(-10px);
  }
  75% {
    transform: translateY(-15px) translateX(5px);
  }
}

/* ========================================
   Math Editor RTL/LTR Mode Toggle
   ======================================== */

/* RTL Mode based on data-rtl attribute */
.math-equation[data-rtl="true"] .katex {
  direction: rtl !important;
  text-align: right !important;
  unicode-bidi: embed !important;
}

/* RTL Mode: Flip superscripts using flexbox */
.math-equation[data-rtl="true"] .katex .msup,
.math-equation[data-rtl="true"] .katex .msupsub,
.math-equation.math-rtl .katex .msup,
.math-equation.math-rtl .katex .msupsub,
.math-rtl .katex .msup,
.math-rtl .katex .msupsub {
  display: inline-flex !important;
  flex-direction: row-reverse !important;
  flex-wrap: nowrap !important;
  align-items: baseline !important;
  direction: ltr !important; /* Keep text LTR, just reverse visual order */
  vertical-align: baseline !important;
  justify-content: flex-start !important;
}

/* RTL Mode: Reverse order of base and superscript */
.math-equation[data-rtl="true"] .katex .msup > *:first-child,
.math-equation[data-rtl="true"] .katex .msupsub > *:first-child,
.math-equation.math-rtl .katex .msup > *:first-child,
.math-equation.math-rtl .katex .msupsub > *:first-child,
.math-rtl .katex .msup > *:first-child,
.math-rtl .katex .msupsub > *:first-child {
  order: 2 !important;
}

.math-equation[data-rtl="true"] .katex .msup > *:last-child,
.math-equation[data-rtl="true"] .katex .msupsub > *:last-child,
.math-equation.math-rtl .katex .msup > *:last-child,
.math-equation.math-rtl .katex .msupsub > *:last-child,
.math-rtl .katex .msup > *:last-child,
.math-rtl .katex .msupsub > *:last-child {
  order: 1 !important;
}

/* Skip operator limits in RTL */
.math-equation[data-rtl="true"] .katex .mop.op-limits .msup,
.math-equation[data-rtl="true"] .katex .mop.op-limits .msupsub,
.math-rtl .katex .mop.op-limits .msup,
.math-rtl .katex .mop.op-limits .msupsub {
  flex-direction: row !important; /* Keep normal order for limits */
}

/* LTR Mode based on data-rtl attribute */
.math-equation[data-rtl="false"] .katex {
  direction: ltr !important;
  text-align: left !important;
  unicode-bidi: normal !important;
}

/* LTR Mode: Normal display */
.math-equation[data-rtl="false"] .katex .msup,
.math-equation[data-rtl="false"] .katex .msupsub {
  display: inline !important;
  flex-direction: initial !important;
}

/* RTL Mode (Arabic): Keep current RTL behavior with flipped superscripts */
.math-rtl-mode .katex {
  direction: rtl !important;
  text-align: right !important;
  unicode-bidi: embed !important;
}

.math-rtl-mode .katex-display,
.math-rtl-mode .katex-display > .katex {
  direction: rtl !important;
  text-align: right !important;
  unicode-bidi: embed !important;
}

/* LTR Mode (English): Standard LTR display without any flipping */
.math-ltr-mode .katex {
  direction: ltr !important;
  text-align: left !important;
  unicode-bidi: normal !important;
}

.math-ltr-mode .katex-display,
.math-ltr-mode .katex-display > .katex {
  direction: ltr !important;
  text-align: left !important;
  unicode-bidi: normal !important;
}

/* LTR Mode: Disable all RTL customizations */
.math-ltr-mode .katex .base {
  display: inline !important;
  flex-direction: initial !important;
}

.math-ltr-mode .katex .mord + .msupsub,
.math-ltr-mode .katex .minner + .msupsub,
.math-ltr-mode .katex .mop + .msupsub {
  display: inline !important;
  flex-direction: initial !important;
}

.math-ltr-mode .katex .sqrt {
  display: inline-flex !important;
  flex-direction: initial !important;
  direction: ltr !important;
}

.math-ltr-mode .katex .sqrt > .root {
  order: initial !important;
  margin-left: 0 !important;
  margin-right: 0.15em !important;
}

/* ========================================
   Roots Mirror Effect (√5 → mirrored image)
   ======================================== */
/* Mirror/flip roots using CSS transform scaleX(-1) - ONLY in RTL mode */
/* RTL mode: Mirrored roots */
.math-rtl .katex .sqrt {
  transform: scaleX(-1) !important;
  display: inline-flex !important;
  flex-wrap: nowrap !important;
  align-items: baseline !important;
  direction: ltr !important;
  white-space: nowrap !important;
}

/* Flip text/numbers back so they're readable in RTL mode */
.math-rtl .katex .sqrt .vlist-r,
/* .math-rtl .katex .sqrt .mord,
.math-rtl .katex .sqrt .mnum, */
.math-rtl .katex .sqrt .root,
.math-rtl .katex .sqrt .vlist-t {
  transform: scaleX(-1) !important;
  display: inline-block !important;
}
.math-rtl .katex .sqrt .vlist-t,
.math-rtl .katex .sqrt .mord,
.math-rtl .katex .sqrt .mnum,
.math-rtl .katex .sqrt .vlist-r
{

  transform: scaleX(-1) translateX(-1.5rem) !important;
  direction: ltr !important;
}

/* Flip wrapped text nodes in RTL mode */
.math-rtl .katex .sqrt .root-flipped-text {
  transform: scaleX(-1)  !important;
  display: inline-block !important;
}

/* LTR mode: Normal roots (no mirror) */
.math-ltr .katex .sqrt {
  transform: none !important;
  display: inline-block !important;
  direction: ltr !important;
}

/* Normal text/numbers in LTR mode */
.math-ltr .katex .sqrt .vlist-r,
.math-ltr .katex .sqrt .mord,
.math-ltr .katex .sqrt .mnum,
.math-ltr .katex .sqrt .root,
.math-ltr .katex .sqrt .vlist-t {
  transform: none !important;
  display: inline-block !important;
}

/* ========================================
   Image positioning and display
   ======================================== */

/* Ensure containers support absolute positioning */
.ql-container,
.ql-editor {
  position: relative !important;
}

/* Images with absolute positioning - maintain position across displays */
.ql-editor img[style*="position: absolute"],
.ql-editor img[style*="position:absolute"],
img[style*="position: absolute"],
img[style*="position:absolute"],
img[data-left-percent],
img[data-top-percent] {
  position: absolute !important;
  pointer-events: auto;
  height: auto !important;
  z-index: 5 !important; /* Medium layer by default - doesn't block text */
}

/* Question container - ensure space for images */
.question-container {
  position: relative !important;
  min-height: 200px !important;
  padding-bottom: 40px !important;
}

/* Answers container - higher z-index to stay on top */
.answers-container {
  position: relative !important;
  z-index: 20 !important;
}

.answers-container button {
  position: relative !important;
  z-index: 21 !important;
}

/* Ensure parent containers in question display also support absolute positioning */
div[style*="position: relative"] img[style*="position: absolute"],
div[style*="position: relative"] img[data-left-percent] {
  position: absolute !important;
}

/* ========================================
   Mobile Optimizations
   ======================================== */

/* Improve touch scrolling on mobile */
html {
  -webkit-overflow-scrolling: touch;
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

body {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  touch-action: manipulation;
}

/* Prevent text selection on buttons and interactive elements */
button, a, input, select, textarea {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

/* Allow text selection in content areas */
p, span, div, h1, h2, h3, h4, h5, h6, li {
  -webkit-user-select: text;
  user-select: text;
}

/* Improve font rendering on mobile */
* {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Safe area support for iOS devices */
@supports (padding: max(0px)) {
  body {
    padding-left: max(0px, env(safe-area-inset-left));
    padding-right: max(0px, env(safe-area-inset-right));
  }
}